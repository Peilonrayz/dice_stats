[tox]
envlist =
    clean
    # {unit,cov}-py{27,34,35,36,37}
    {unit,cov}-py37

    check
    docs
    report

[testenv]
basepython =
    py27: python2.7
    py34: python3.4
    py35: python3.5
    py36: python3.6
    py37: python3.7
    py38: python3.8
    pynightly: python3.8
deps =
    pytest
    cov: coverage
setenv=
    cov-py{27,34,35,36,37}: COVERAGE_FILE=.coverage.{envname}
    PIP_DISABLE_PIP_VERSION_CHECK=1
    VIRTUALENV_NO_DOWNLOAD=1
commands =
    unit: pytest tests/
    cov: coverage run --source {envdir}/lib/site-packages/dice_stats -m pytest tests/

[testenv:clean]
basepython = python3.7
skip_install = True
deps =
    coverage
commands =
    coverage erase

[coverage:paths]
source =
    src
    .tox/*/lib/python*/site-packages
    .tox/*/site-packages

[testenv:report]
basepython = python3.7
skip_install = True
depends =
    {unit,cov}-py37
deps =
    coverage
commands =
    coverage combine
    coverage html
    coverage report

[testenv:check]
basepython = python3.7
skip_install = True
deps =
    check-manifest
    prospector
    mypy

    .[dev]
commands =
    python setup.py check --strict --metadata
    check-manifest {toxinidir}
    mypy src/dice_stats --config-file tox.ini
    mypy tests --config-file tox.ini
    prospector src/ --profile prospector.yaml
    prospector tests/ --profile prospector-tests.yaml
    prospector --profile prospector-docstrings.yaml

[check-manifest]
ignore =
    configs
    configs\*
    docs
    docs\*
    tests
    tests\*
    tox.ini
    prospector.yaml
    prospector-docstrings.yaml
    prospector-tests.yaml

[mypy]
warn_unused_configs = True
warn_unused_ignores = True
warn_unreachable = True
ignore_missing_imports = True

[testenv:docs]
basepython = python3.7
deps =
    Sphinx
    sphinx-markdown-builder
    sphinx-autodoc-typehints
    pytest
    matplotlib

    .[dev]
commands =
    pytest docs/source/
    sphinx-build -b doctest docs/source docs/build/_build/doctest -a
    sphinx-build -b linkcheck docs/source docs/build/_build/linkcheck -a
    sphinx-build -b html docs/source docs/build/_build/html -a
